<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Circle Mint â€” Dev Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Syne:wght@500;600;700;800&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #0b0e17;
  --sidebar: #0f1420;
  --card: #131826;
  --card-border: #1e2438;
  --accent: #3772FF;
  --accent-dim: rgba(55,114,255,.12);
  --accent-glow: rgba(55,114,255,.25);
  --green: #00d97e;
  --green-dim: rgba(0,217,126,.1);
  --red: #ff4d6d;
  --red-dim: rgba(255,77,109,.1);
  --yellow: #ffc947;
  --text: #e2e8f0;
  --text-dim: #64748b;
  --text-muted: #334155;
  --mono: 'IBM Plex Mono', monospace;
  --sans: 'Syne', sans-serif;
  --radius: 10px;
  --sidebar-w: 220px;
}

html { scroll-behavior: smooth; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--mono);
  font-size: 13px;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.app {
  display: flex;
  flex: 1;
  overflow: hidden;
  height: calc(100vh - 300px);
}

/* â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar {
  width: var(--sidebar-w);
  background: var(--sidebar);
  border-right: 1px solid var(--card-border);
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  flex-shrink: 0;
  z-index: 10;
}

.logo {
  padding: 20px 18px 16px;
  border-bottom: 1px solid var(--card-border);
}
.logo-wordmark {
  font-family: var(--sans);
  font-size: 16px;
  font-weight: 800;
  letter-spacing: -.3px;
  color: #fff;
}
.logo-sub {
  font-size: 10px;
  color: var(--text-dim);
  margin-top: 2px;
  letter-spacing: .05em;
  text-transform: uppercase;
}

.env-badge {
  margin: 12px 18px;
  background: var(--accent-dim);
  border: 1px solid var(--accent-glow);
  color: var(--accent);
  border-radius: 4px;
  padding: 4px 8px;
  font-size: 10px;
  letter-spacing: .08em;
  text-transform: uppercase;
  display: flex;
  align-items: center;
  gap: 6px;
}
.env-badge::before {
  content: '';
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--accent);
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0%,100% { opacity: 1; }
  50% { opacity: .3; }
}

.nav { padding: 8px 0; flex: 1; }
.nav-section { padding: 16px 18px 4px; font-size: 9px; text-transform: uppercase; letter-spacing: .12em; color: var(--text-muted); }
.nav-item {
  display: flex;
  align-items: center;
  gap: 9px;
  padding: 9px 18px;
  cursor: pointer;
  border-left: 2px solid transparent;
  color: var(--text-dim);
  font-size: 12px;
  transition: all .15s;
  text-decoration: none;
}
.nav-item:hover { color: var(--text); background: rgba(255,255,255,.03); }
.nav-item.active { color: var(--accent); border-left-color: var(--accent); background: var(--accent-dim); }
.nav-icon { font-size: 14px; width: 18px; text-align: center; }

.notif-dot {
  margin-left: auto;
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--yellow);
  display: none;
}
.notif-dot.visible { display: block; }

/* â”€â”€ Main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main {
  flex: 1;
  overflow-y: auto;
  padding: 24px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.section { display: none; flex-direction: column; gap: 16px; }
.section.active { display: flex; }

.section-header {
  display: flex;
  align-items: baseline;
  gap: 12px;
  margin-bottom: 4px;
}
.section-title {
  font-family: var(--sans);
  font-size: 22px;
  font-weight: 700;
  color: #fff;
}
.section-desc { font-size: 12px; color: var(--text-dim); }

.cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: 14px;
}

/* â”€â”€ Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: var(--radius);
  padding: 18px;
  display: flex;
  flex-direction: column;
  gap: 14px;
  transition: border-color .2s;
}
.card:hover { border-color: #2a3050; }

.card-header { display: flex; align-items: flex-start; justify-content: space-between; gap: 8px; }
.card-title {
  font-family: var(--sans);
  font-size: 14px;
  font-weight: 600;
  color: #fff;
}
.card-method {
  font-size: 10px;
  padding: 2px 7px;
  border-radius: 4px;
  letter-spacing: .06em;
  font-weight: 600;
  flex-shrink: 0;
}
.method-get { background: rgba(0,217,126,.15); color: var(--green); }
.method-post { background: var(--accent-dim); color: var(--accent); }
.method-delete { background: var(--red-dim); color: var(--red); }
.card-endpoint { font-size: 10px; color: var(--text-dim); margin-top: 2px; font-family: var(--mono); }

/* â”€â”€ Step Badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.step-badge {
  width: 26px; height: 26px;
  border-radius: 50%;
  background: var(--accent-dim);
  border: 1px solid var(--accent-glow);
  color: var(--accent);
  font-family: var(--sans);
  font-size: 11px;
  font-weight: 700;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}
.step-badge.done { background: var(--green-dim); border-color: rgba(0,217,126,.3); color: var(--green); }

/* â”€â”€ Form fields â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.fields { display: flex; flex-direction: column; gap: 10px; }
.field { display: flex; flex-direction: column; gap: 4px; }
.field label { font-size: 10px; color: var(--text-dim); text-transform: uppercase; letter-spacing: .08em; }
.field input, .field select {
  background: #0b0e17;
  border: 1px solid var(--card-border);
  border-radius: 6px;
  color: var(--text);
  font-family: var(--mono);
  font-size: 12px;
  padding: 8px 10px;
  outline: none;
  transition: border-color .15s;
  width: 100%;
}
.field input:focus, .field select:focus { border-color: var(--accent); }
.field input::placeholder { color: var(--text-muted); }
.field select option { background: #131826; }
.required-mark { color: var(--accent); margin-left: 2px; }

/* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 9px 16px;
  border-radius: 7px;
  border: none;
  cursor: pointer;
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 600;
  letter-spacing: .02em;
  transition: all .15s;
  white-space: nowrap;
}
.btn-primary {
  background: var(--accent);
  color: #fff;
}
.btn-primary:hover { background: #4d85ff; box-shadow: 0 0 16px var(--accent-glow); }
.btn-primary:active { background: #2b5fe8; }
.btn-danger { background: var(--red-dim); color: var(--red); border: 1px solid rgba(255,77,109,.2); }
.btn-danger:hover { background: rgba(255,77,109,.2); }
.btn-ghost { background: transparent; color: var(--text-dim); border: 1px solid var(--card-border); }
.btn-ghost:hover { color: var(--text); border-color: #2a3050; }
.btn[disabled] { opacity: .5; cursor: not-allowed; }

.btn-full { width: 100%; }

/* â”€â”€ Spinner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.spinner {
  width: 12px; height: 12px;
  border: 2px solid rgba(255,255,255,.2);
  border-top-color: #fff;
  border-radius: 50%;
  animation: spin .6s linear infinite;
  display: none;
}
.btn.loading .spinner { display: block; }
.btn.loading .btn-label { display: none; }
@keyframes spin { to { transform: rotate(360deg); } }

/* â”€â”€ Run All stepper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.run-all-bar {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: var(--radius);
  padding: 16px 18px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  flex-wrap: wrap;
}
.run-all-info { font-size: 12px; color: var(--text-dim); }
.run-all-info strong { color: var(--text); font-family: var(--sans); font-size: 14px; display: block; margin-bottom: 2px; }

/* â”€â”€ Notifications section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.notif-feed {
  display: flex;
  flex-direction: column;
  gap: 8px;
  max-height: 400px;
  overflow-y: auto;
}
.notif-item {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-left: 3px solid var(--yellow);
  border-radius: 6px;
  padding: 10px 14px;
  animation: slideIn .2s ease;
}
@keyframes slideIn {
  from { opacity: 0; transform: translateY(-6px); }
  to { opacity: 1; transform: translateY(0); }
}
.notif-type { font-size: 10px; color: var(--yellow); text-transform: uppercase; letter-spacing: .08em; margin-bottom: 4px; }
.notif-body { font-size: 11px; color: var(--text-dim); white-space: pre-wrap; word-break: break-all; }
.notif-time { font-size: 10px; color: var(--text-muted); margin-top: 4px; }

/* â”€â”€ Log panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.log-panel {
  height: 300px;
  background: #080a12;
  border-top: 1px solid var(--card-border);
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
}
.log-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 16px;
  border-bottom: 1px solid var(--card-border);
  background: #0a0d18;
}
.log-title {
  font-size: 11px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: .1em;
  display: flex;
  align-items: center;
  gap: 8px;
}
.log-blink {
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--green);
  animation: pulse 1.5s infinite;
}
.log-body {
  flex: 1;
  overflow-y: auto;
  padding: 10px 16px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.log-entry {
  display: grid;
  grid-template-columns: auto auto 1fr;
  gap: 12px;
  align-items: flex-start;
  animation: fadeIn .2s ease;
  padding: 6px 8px;
  border-radius: 5px;
  background: rgba(255,255,255,.02);
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.log-ts { color: var(--text-muted); font-size: 10px; white-space: nowrap; padding-top: 1px; }
.log-tag {
  font-size: 10px;
  padding: 1px 6px;
  border-radius: 3px;
  font-weight: 600;
  white-space: nowrap;
}
.tag-ok  { background: var(--green-dim); color: var(--green); }
.tag-err { background: var(--red-dim); color: var(--red); }
.tag-info { background: var(--accent-dim); color: var(--accent); }
.log-content {
  font-size: 11px;
  color: var(--text);
  white-space: pre-wrap;
  word-break: break-all;
  line-height: 1.5;
}
.log-json { color: #a5c3ff; }

/* â”€â”€ Scrollbars â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--card-border); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: #2a3050; }

/* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#toast-container {
  position: fixed;
  top: 16px; right: 16px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 1000;
}
.toast {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: 8px;
  padding: 10px 14px;
  font-size: 12px;
  max-width: 320px;
  animation: slideInRight .2s ease;
  display: flex; align-items: center; gap: 8px;
}
@keyframes slideInRight {
  from { opacity: 0; transform: translateX(20px); }
  to { opacity: 1; transform: translateX(0); }
}
.toast.success { border-left: 3px solid var(--green); }
.toast.error { border-left: 3px solid var(--red); }
.toast.info { border-left: 3px solid var(--accent); }

/* â”€â”€ Sublist for wire accounts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.data-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-top: 4px;
}
.data-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 10px;
  background: rgba(255,255,255,.03);
  border-radius: 5px;
  font-size: 11px;
  gap: 8px;
  flex-wrap: wrap;
}
.data-id { color: var(--text-dim); font-size: 10px; }
.data-status { padding: 2px 6px; border-radius: 3px; font-size: 10px; }
.status-active, .status-complete { background: var(--green-dim); color: var(--green); }
.status-pending { background: rgba(255,201,71,.1); color: var(--yellow); }
.status-failed  { background: var(--red-dim); color: var(--red); }

@media (max-width: 768px) {
  .sidebar { width: 56px; }
  .logo-wordmark, .logo-sub, .env-badge, .nav-section, .nav-item span:not(.nav-icon) { display: none; }
  .nav-item { padding: 12px; justify-content: center; }
}
</style>
</head>
<body>

<div id="toast-container"></div>

<div class="app">
  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="logo">
      <div class="logo-wordmark">Circle Mint</div>
      <div class="logo-sub">Dev Dashboard</div>
    </div>
    <div class="env-badge" id="env-badge">sandbox</div>
    <div class="nav">
      <div class="nav-section">Core</div>
      <a class="nav-item active" data-section="overview" href="#">
        <span class="nav-icon">â—ˆ</span><span>Overview</span>
      </a>
      <a class="nav-item" data-section="deposits" href="#">
        <span class="nav-icon">â†“</span><span>Deposits</span>
      </a>
      <a class="nav-item" data-section="payouts" href="#">
        <span class="nav-icon">â†‘</span><span>Payouts</span>
      </a>
      <div class="nav-section">Banking</div>
      <a class="nav-item" data-section="withdrawals" href="#">
        <span class="nav-icon">ğŸ¦</span><span>Withdrawals</span>
      </a>
      <a class="nav-item" data-section="transfers" href="#">
        <span class="nav-icon">â‡„</span><span>Transfers</span>
      </a>
      <div class="nav-section">Advanced</div>
      <a class="nav-item" data-section="express" href="#">
        <span class="nav-icon">âš¡</span><span>Express Route</span>
      </a>
      <a class="nav-item" data-section="notifications" href="#">
        <span class="nav-icon">ğŸ””</span><span>Notifications</span>
        <span class="notif-dot" id="notif-nav-dot"></span>
      </a>
    </div>
  </nav>

  <!-- Main content -->
  <main class="main">

    <!-- â”€â”€ Overview â”€â”€ -->
    <div class="section active" id="section-overview">
      <div class="section-header">
        <div class="section-title">Overview</div>
        <div class="section-desc">Account balance and configuration</div>
      </div>
      <div class="cards-grid">
        <!-- Balance -->
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Get Balance</div>
              <div class="card-endpoint">GET /api/balance</div>
            </div>
            <span class="card-method method-get">GET</span>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('GET','/api/balance',null,this)">
            <div class="spinner"></div><span class="btn-label">Fetch Balance</span>
          </button>
        </div>
        <!-- Chains -->
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Supported Chains</div>
              <div class="card-endpoint">GET /api/chains</div>
            </div>
            <span class="card-method method-get">GET</span>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('GET','/api/chains',null,this)">
            <div class="spinner"></div><span class="btn-label">Fetch Chains</span>
          </button>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Deposits â”€â”€ -->
    <div class="section" id="section-deposits">
      <div class="section-header">
        <div class="section-title">Deposits</div>
        <div class="section-desc">Manage on-chain deposit addresses and incoming deposits</div>
      </div>
      <div class="cards-grid">
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">List Deposits</div><div class="card-endpoint">GET /api/deposits</div></div>
            <span class="card-method method-get">GET</span>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('GET','/api/deposits',null,this)">
            <div class="spinner"></div><span class="btn-label">List Deposits</span>
          </button>
        </div>
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">List Deposit Addresses</div><div class="card-endpoint">GET /api/deposits/addresses</div></div>
            <span class="card-method method-get">GET</span>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('GET','/api/deposits/addresses',null,this)">
            <div class="spinner"></div><span class="btn-label">List Addresses</span>
          </button>
        </div>
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">Create Deposit Address</div><div class="card-endpoint">POST /api/deposits/addresses</div></div>
            <span class="card-method method-post">POST</span>
          </div>
          <div class="fields">
            <div class="field">
              <label>Chain<span class="required-mark">*</span></label>
              <select id="dep-chain">
                <option value="ETH">ETH</option><option value="MATIC">MATIC</option>
                <option value="AVAX">AVAX</option><option value="BASE">BASE</option>
                <option value="ARB">ARB</option><option value="SOL">SOL</option>
                <option value="BTC">BTC</option>
              </select>
            </div>
            <div class="field">
              <label>Currency</label>
              <input id="dep-currency" value="USD" placeholder="USD">
            </div>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/deposits/addresses',{chain:v('dep-chain'),currency:v('dep-currency')||'USD'},this)">
            <div class="spinner"></div><span class="btn-label">Create Address</span>
          </button>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Payouts â”€â”€ -->
    <div class="section" id="section-payouts">
      <div class="section-header">
        <div class="section-title">Payouts</div>
        <div class="section-desc">Send crypto payouts â€” addresses must be added to the address book first</div>
      </div>

      <div style="background:var(--accent-dim);border:1px solid var(--accent-glow);border-radius:var(--radius);padding:12px 16px;font-size:11px;color:var(--text-dim);line-height:1.6">
        <strong style="color:var(--accent)">Two-step flow:</strong>
        Step 1 â€” add the destination address to your <strong>Address Book</strong>.
        Step 2 â€” create a payout using that entry's <strong>Recipient ID</strong>.
        Amounts are automatically formatted to 2 decimal places.
      </div>

      <div style="font-family:var(--sans);font-size:14px;font-weight:600;color:var(--text-dim);margin-top:4px">Step 1 â€” Address Book</div>
      <div class="cards-grid">
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">List Address Book</div><div class="card-endpoint">GET /api/payouts/address-book</div></div>
            <span class="card-method method-get">GET</span>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('GET','/api/payouts/address-book',null,this)">
            <div class="spinner"></div><span class="btn-label">List Recipients</span>
          </button>
        </div>
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">Add to Address Book</div><div class="card-endpoint">POST /api/payouts/address-book</div></div>
            <span class="card-method method-post">POST</span>
          </div>
          <div class="fields">
            <div class="field"><label>Chain<span class="required-mark">*</span></label>
              <select id="ab-chain"><option>ETH</option><option>MATIC</option><option>AVAX</option><option>BASE</option><option>ARB</option><option>SOL</option><option>BTC</option></select>
            </div>
            <div class="field"><label>Address<span class="required-mark">*</span></label><input id="ab-address" placeholder="0x..."></div>
            <div class="field"><label>Nickname</label><input id="ab-nickname" placeholder="My wallet"></div>
            <div class="field"><label>Address Tag <em style="color:var(--text-muted)">(XLM, HBAR etc.)</em></label><input id="ab-tag" placeholder="optional memo"></div>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/payouts/address-book',{chain:v('ab-chain'),address:v('ab-address'),nickname:v('ab-nickname')||undefined,addressTag:v('ab-tag')||undefined},this)">
            <div class="spinner"></div><span class="btn-label">Add Recipient</span>
          </button>
        </div>
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">Remove from Address Book</div><div class="card-endpoint">DELETE /api/payouts/address-book/:id</div></div>
            <span class="card-method method-delete">DELETE</span>
          </div>
          <div class="fields">
            <div class="field"><label>Recipient ID<span class="required-mark">*</span></label><input id="ab-del-id" placeholder="uuid"></div>
          </div>
          <button class="btn btn-danger btn-full" onclick="callApi('DELETE',`/api/payouts/address-book/${v('ab-del-id')}`,null,this)">
            <div class="spinner"></div><span class="btn-label">Remove</span>
          </button>
        </div>
      </div>

      <div style="font-family:var(--sans);font-size:14px;font-weight:600;color:var(--text-dim);margin-top:8px">Step 2 â€” Send Payout</div>
      <div class="cards-grid">
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">List Payouts</div><div class="card-endpoint">GET /api/payouts</div></div>
            <span class="card-method method-get">GET</span>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('GET','/api/payouts',null,this)">
            <div class="spinner"></div><span class="btn-label">List Payouts</span>
          </button>
        </div>
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">Create Payout</div><div class="card-endpoint">POST /api/payouts</div></div>
            <span class="card-method method-post">POST</span>
          </div>
          <div class="fields">
            <div class="field"><label>Recipient ID <em style="color:var(--text-muted)">(from address book)</em><span class="required-mark">*</span></label><input id="po-recip" placeholder="uuid"></div>
            <div class="field"><label>Amount<span class="required-mark">*</span></label><input id="po-amount" placeholder="1.00" title="Formatted to 2 decimal places automatically"></div>
            <div class="field"><label>Currency</label>
              <select id="po-currency"><option value="USD">USD (USDC)</option><option value="EUR">EUR (EURC)</option></select>
            </div>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/payouts',{recipientId:v('po-recip'),amount:v('po-amount'),currency:v('po-currency')},this)">
            <div class="spinner"></div><span class="btn-label">Create Payout</span>
          </button>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Withdrawals â”€â”€ -->
    <div class="section" id="section-withdrawals">
      <div class="section-header">
        <div class="section-title">Withdrawals</div>
        <div class="section-desc">Wire bank accounts and fiat offramp payouts</div>
      </div>
      <div class="cards-grid">
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">List Wire Accounts</div><div class="card-endpoint">GET /api/banks/wires</div></div>
            <span class="card-method method-get">GET</span>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('GET','/api/banks/wires',null,this)">
            <div class="spinner"></div><span class="btn-label">List Accounts</span>
          </button>
        </div>
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">Create Wire Account</div><div class="card-endpoint">POST /api/banks/wires</div></div>
            <span class="card-method method-post">POST</span>
          </div>
          <p style="font-size:11px;color:var(--text-dim)">Uses sandbox test data (Satoshi Nakamoto, routing 121000248)</p>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/banks/wires',{},this)">
            <div class="spinner"></div><span class="btn-label">Create Account</span>
          </button>
        </div>
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">Get Wire Instructions</div><div class="card-endpoint">GET /api/banks/wires/:id/instructions</div></div>
            <span class="card-method method-get">GET</span>
          </div>
          <div class="fields">
            <div class="field"><label>Bank Account ID<span class="required-mark">*</span></label><input id="wi-id" placeholder="uuid"></div>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('GET',`/api/banks/wires/${v('wi-id')}/instructions`,null,this)">
            <div class="spinner"></div><span class="btn-label">Get Instructions</span>
          </button>
        </div>
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">Mock Wire Deposit</div><div class="card-endpoint">POST /api/mocks/wire</div></div>
            <span class="card-method method-post">POST</span>
          </div>
          <div class="fields">
            <div class="field"><label>Tracking Ref<span class="required-mark">*</span></label><input id="mw-ref" placeholder="CIR..."></div>
            <div class="field"><label>Amount</label><input id="mw-amount" value="100.00"></div>
            <div class="field"><label>Beneficiary Account #<span class="required-mark">*</span></label><input id="mw-acct" placeholder="From wire instructions"></div>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/mocks/wire',{trackingRef:v('mw-ref'),amount:v('mw-amount')||'100.00',accountNumber:v('mw-acct')},this)">
            <div class="spinner"></div><span class="btn-label">Simulate Deposit</span>
          </button>
        </div>
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">Withdraw to Bank</div><div class="card-endpoint">POST /api/payouts/wire</div></div>
            <span class="card-method method-post">POST</span>
          </div>
          <div class="fields">
            <div class="field"><label>Bank Account ID<span class="required-mark">*</span></label><input id="wd-bankid" placeholder="uuid"></div>
            <div class="field"><label>Amount<span class="required-mark">*</span></label><input id="wd-amount" placeholder="100.00"></div>
            <div class="field"><label>Currency</label>
              <select id="wd-currency"><option>USD</option><option>EUR</option><option>MXN</option><option>SGD</option><option>BRL</option></select>
            </div>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/payouts/wire',{bankId:v('wd-bankid'),amount:v('wd-amount'),currency:v('wd-currency')},this)">
            <div class="spinner"></div><span class="btn-label">Withdraw</span>
          </button>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Transfers â”€â”€ -->
    <div class="section" id="section-transfers">
      <div class="section-header">
        <div class="section-title">Transfers</div>
        <div class="section-desc">Recipient addresses and on-chain business transfers</div>
      </div>
      <div class="cards-grid">
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">List Recipients</div><div class="card-endpoint">GET /api/recipients</div></div>
            <span class="card-method method-get">GET</span>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('GET','/api/recipients',null,this)">
            <div class="spinner"></div><span class="btn-label">List Recipients</span>
          </button>
        </div>
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">Create Recipient</div><div class="card-endpoint">POST /api/recipients</div></div>
            <span class="card-method method-post">POST</span>
          </div>
          <div class="fields">
            <div class="field"><label>Chain<span class="required-mark">*</span></label>
              <select id="cr-chain"><option>ETH</option><option>MATIC</option><option>AVAX</option><option>BASE</option><option>ARB</option><option>SOL</option></select>
            </div>
            <div class="field"><label>Address<span class="required-mark">*</span></label><input id="cr-address" placeholder="0x..."></div>
            <div class="field"><label>Description<span class="required-mark">*</span></label><input id="cr-desc" placeholder="My wallet"></div>
            <div class="field"><label>Address Tag <em style="color:var(--text-muted)">(optional)</em></label><input id="cr-tag" placeholder="For XLM, HBAR etc."></div>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/recipients',{chain:v('cr-chain'),address:v('cr-address'),description:v('cr-desc'),addressTag:v('cr-tag')||undefined},this)">
            <div class="spinner"></div><span class="btn-label">Create Recipient</span>
          </button>
        </div>
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">Business Transfer</div><div class="card-endpoint">POST /api/transfers/business</div></div>
            <span class="card-method method-post">POST</span>
          </div>
          <div class="fields">
            <div class="field"><label>Recipient ID<span class="required-mark">*</span></label><input id="bt-recip" placeholder="uuid"></div>
            <div class="field"><label>Amount</label><input id="bt-amount" value="1.00"></div>
            <div class="field"><label>Currency</label>
              <select id="bt-currency"><option>USD</option><option>EUR</option><option>BTC</option><option>ETH</option></select>
            </div>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/transfers/business',{recipientId:v('bt-recip'),amount:v('bt-amount')||'1.00',currency:v('bt-currency')},this)">
            <div class="spinner"></div><span class="btn-label">Send Transfer</span>
          </button>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Express Route â”€â”€ -->
    <div class="section" id="section-express">
      <div class="section-header">
        <div class="section-title">Express Route</div>
        <div class="section-desc">Auto-redeem on-chain USDC to local fiat â€” run each step or trigger the full flow</div>
      </div>

      <div class="run-all-bar">
        <div class="run-all-info">
          <strong>Run Full Flow</strong>
          Steps 1â€“7 executed automatically. Step 5 skipped if no recipient ID provided.
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
          <div class="field" style="flex:1;min-width:120px">
            <label>Chain</label>
            <select id="run-chain" style="min-width:100px"><option>ETH</option><option>MATIC</option><option>AVAX</option><option>BASE</option><option>ARB</option></select>
          </div>
          <div class="field" style="flex:1;min-width:100px">
            <label>Amount</label>
            <input id="run-amount" value="10.00" style="min-width:80px">
          </div>
          <button class="btn btn-primary" style="margin-top:16px" onclick="callApi('POST','/api/express-route/run',{chain:v('run-chain'),amount:v('run-amount')||'10.00'},this)">
            <div class="spinner"></div><span class="btn-label">âš¡ Run All Steps</span>
          </button>
        </div>
      </div>

      <div class="cards-grid">
        <!-- Step 1 -->
        <div class="card">
          <div class="card-header">
            <div style="display:flex;align-items:center;gap:10px">
              <div class="step-badge" id="step-1-badge">1</div>
              <div><div class="card-title">Link Bank Account</div><div class="card-endpoint">POST /api/express-route/link-bank</div></div>
            </div>
            <span class="card-method method-post">POST</span>
          </div>
          <div class="fields">
            <div class="field"><label>Account Number</label><input id="s1-acct" value="12340010"></div>
            <div class="field"><label>Routing Number</label><input id="s1-route" value="121000248"></div>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/express-route/link-bank',{accountNumber:v('s1-acct'),routingNumber:v('s1-route')},this,'step-1-badge')">
            <div class="spinner"></div><span class="btn-label">Link Bank</span>
          </button>
        </div>
        <!-- Step 2 -->
        <div class="card">
          <div class="card-header">
            <div style="display:flex;align-items:center;gap:10px">
              <div class="step-badge" id="step-2-badge">2</div>
              <div><div class="card-title">Link Receipt Address</div><div class="card-endpoint">POST /api/express-route/link-receipt</div></div>
            </div>
            <span class="card-method method-post">POST</span>
          </div>
          <div class="fields">
            <div class="field"><label>Chain</label>
              <select id="s2-chain"><option>ETH</option><option>MATIC</option><option>AVAX</option><option>BASE</option><option>ARB</option><option>SOL</option></select>
            </div>
            <div class="field"><label>Currency</label><input id="s2-currency" value="USD"></div>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/express-route/link-receipt',{chain:v('s2-chain'),currency:v('s2-currency')||'USD'},this,'step-2-badge')">
            <div class="spinner"></div><span class="btn-label">Link Receipt Address</span>
          </button>
        </div>
        <!-- Step 3 -->
        <div class="card">
          <div class="card-header">
            <div style="display:flex;align-items:center;gap:10px">
              <div class="step-badge" id="step-3-badge">3</div>
              <div><div class="card-title">Mock Wire Deposit</div><div class="card-endpoint">POST /api/express-route/mock-deposit</div></div>
            </div>
            <span class="card-method method-post">POST</span>
          </div>
          <div class="fields">
            <div class="field"><label>Tracking Ref<span class="required-mark">*</span></label><input id="s3-ref" placeholder="From wire instructions"></div>
            <div class="field"><label>Amount</label><input id="s3-amount" value="100.00"></div>
            <div class="field"><label>Beneficiary Acct #<span class="required-mark">*</span></label><input id="s3-acct" placeholder="From wire instructions"></div>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/express-route/mock-deposit',{trackingRef:v('s3-ref'),amount:v('s3-amount')||'100.00',accountNumber:v('s3-acct')},this,'step-3-badge')">
            <div class="spinner"></div><span class="btn-label">Simulate Deposit</span>
          </button>
        </div>
        <!-- Step 4 -->
        <div class="card">
          <div class="card-header">
            <div style="display:flex;align-items:center;gap:10px">
              <div class="step-badge" id="step-4-badge">4</div>
              <div><div class="card-title">On-Chain Deposit</div><div class="card-endpoint">POST /api/express-route/onchain-deposit</div></div>
            </div>
            <span class="card-method method-post">POST</span>
          </div>
          <div class="fields">
            <div class="field"><label>Deposit Address<span class="required-mark">*</span></label><input id="s4-addr" placeholder="0x..."></div>
            <div class="field"><label>Chain</label><input id="s4-chain" value="ETH"></div>
            <div class="field"><label>Amount</label><input id="s4-amount" value="10.00"></div>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/express-route/onchain-deposit',{address:v('s4-addr'),chain:v('s4-chain')||'ETH',amount:v('s4-amount')||'10.00'},this,'step-4-badge')">
            <div class="spinner"></div><span class="btn-label">Simulate On-Chain</span>
          </button>
        </div>
        <!-- Step 5 -->
        <div class="card">
          <div class="card-header">
            <div style="display:flex;align-items:center;gap:10px">
              <div class="step-badge" id="step-5-badge">5</div>
              <div><div class="card-title">On-Chain Transfer</div><div class="card-endpoint">POST /api/express-route/transfer</div></div>
            </div>
            <span class="card-method method-post">POST</span>
          </div>
          <div class="fields">
            <div class="field"><label>Recipient ID<span class="required-mark">*</span></label><input id="s5-recip" placeholder="uuid"></div>
            <div class="field"><label>Amount</label><input id="s5-amount" value="1.00"></div>
            <div class="field"><label>Currency</label>
              <select id="s5-currency"><option>USD</option><option>EUR</option><option>BTC</option><option>ETH</option></select>
            </div>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/express-route/transfer',{recipientId:v('s5-recip'),amount:v('s5-amount')||'1.00',currency:v('s5-currency')},this,'step-5-badge')">
            <div class="spinner"></div><span class="btn-label">Send Transfer</span>
          </button>
        </div>
        <!-- Step 6 -->
        <div class="card">
          <div class="card-header">
            <div style="display:flex;align-items:center;gap:10px">
              <div class="step-badge" id="step-6-badge">6</div>
              <div><div class="card-title">Withdrawal</div><div class="card-endpoint">POST /api/express-route/withdraw</div></div>
            </div>
            <span class="card-method method-post">POST</span>
          </div>
          <div class="fields">
            <div class="field"><label>Bank Account ID<span class="required-mark">*</span></label><input id="s6-bank" placeholder="uuid"></div>
            <div class="field"><label>Amount</label><input id="s6-amount" value="10.00"></div>
            <div class="field"><label>Currency</label>
              <select id="s6-currency"><option>USD</option><option>EUR</option><option>MXN</option><option>SGD</option><option>BRL</option></select>
            </div>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/express-route/withdraw',{bankAccountId:v('s6-bank'),amount:v('s6-amount')||'10.00',currency:v('s6-currency')},this,'step-6-badge')">
            <div class="spinner"></div><span class="btn-label">Withdraw</span>
          </button>
        </div>
        <!-- Step 7 -->
        <div class="card">
          <div class="card-header">
            <div style="display:flex;align-items:center;gap:10px">
              <div class="step-badge" id="step-7-badge">7</div>
              <div><div class="card-title">Create Express Route</div><div class="card-endpoint">POST /api/express-route/create</div></div>
            </div>
            <span class="card-method method-post">POST</span>
          </div>
          <div class="fields">
            <div class="field"><label>Receipt Address ID<span class="required-mark">*</span></label><input id="s7-addrId" placeholder="uuid"></div>
            <div class="field"><label>Bank Account ID<span class="required-mark">*</span></label><input id="s7-bank" placeholder="uuid"></div>
            <div class="field"><label>Destination Type</label>
              <select id="s7-type"><option value="wire">wire</option><option value="sepa">sepa</option><option value="sepa_instant">sepa_instant</option></select>
            </div>
            <div class="field"><label>Currency</label>
              <select id="s7-currency"><option>USD</option><option>EUR</option></select>
            </div>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/express-route/create',{receiptAddressId:v('s7-addrId'),bankAccountId:v('s7-bank'),destinationType:v('s7-type'),currency:v('s7-currency')},this,'step-7-badge')">
            <div class="spinner"></div><span class="btn-label">Create Route</span>
          </button>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Notifications â”€â”€ -->
    <div class="section" id="section-notifications">
      <div class="section-header">
        <div class="section-title">Notifications</div>
        <div class="section-desc">Webhook subscriptions and live event stream</div>
      </div>
      <div class="cards-grid">
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">List Subscriptions</div><div class="card-endpoint">GET /api/notifications/subscriptions</div></div>
            <span class="card-method method-get">GET</span>
          </div>
          <button class="btn btn-primary btn-full" onclick="callApi('GET','/api/notifications/subscriptions',null,this)">
            <div class="spinner"></div><span class="btn-label">List Subscriptions</span>
          </button>
        </div>
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">Create Subscription</div><div class="card-endpoint">POST /api/notifications/subscriptions</div></div>
            <span class="card-method method-post">POST</span>
          </div>
          <div class="fields">
            <div class="field">
              <label>Webhook Endpoint<span class="required-mark">*</span></label>
              <input id="sub-endpoint" placeholder="https://your-server.com/webhooks">
            </div>
          </div>
          <p style="font-size:10px;color:var(--text-muted);margin-top:2px">Must be a publicly accessible HTTPS URL. For local dev, use a tunnel like ngrok pointed at <code>http://localhost:3000/webhooks</code></p>
          <button class="btn btn-primary btn-full" onclick="callApi('POST','/api/notifications/subscriptions',{endpoint:v('sub-endpoint')},this)">
            <div class="spinner"></div><span class="btn-label">Subscribe</span>
          </button>
        </div>
        <div class="card">
          <div class="card-header">
            <div><div class="card-title">Delete Subscription</div><div class="card-endpoint">DELETE /api/notifications/subscriptions/:id</div></div>
            <span class="card-method method-delete">DELETE</span>
          </div>
          <div class="fields">
            <div class="field"><label>Subscription ID<span class="required-mark">*</span></label><input id="del-sub-id" placeholder="uuid"></div>
          </div>
          <button class="btn btn-danger btn-full" onclick="callApi('DELETE',`/api/notifications/subscriptions/${v('del-sub-id')}`,null,this)">
            <div class="spinner"></div><span class="btn-label">Delete</span>
          </button>
        </div>
      </div>

      <!-- Live event feed -->
      <div style="margin-top:8px">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
          <div style="font-family:var(--sans);font-size:16px;font-weight:600;color:#fff;display:flex;align-items:center;gap:8px">
            <span style="width:8px;height:8px;border-radius:50%;background:var(--green);display:inline-block;animation:pulse 1.5s infinite"></span>
            Live Event Stream
          </div>
          <button class="btn btn-ghost" onclick="document.getElementById('notif-feed').innerHTML=''">Clear</button>
        </div>
        <p style="font-size:11px;color:var(--text-muted);margin-bottom:10px">Webhooks received at <code style="color:var(--text-dim)">/webhooks</code> appear here in real-time via SSE.</p>
        <div class="notif-feed" id="notif-feed">
          <div style="font-size:11px;color:var(--text-muted);text-align:center;padding:20px">Waiting for events...</div>
        </div>
      </div>
    </div>

  </main>
</div>

<!-- Log panel -->
<div class="log-panel">
  <div class="log-header">
    <div class="log-title">
      <div class="log-blink" id="log-blink"></div>
      API Output Log
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn btn-ghost" style="padding:4px 10px;font-size:10px" onclick="document.getElementById('log-body').innerHTML=''">Clear</button>
    </div>
  </div>
  <div class="log-body" id="log-body">
    <div style="color:var(--text-muted);font-size:11px;text-align:center;padding:12px">Run a command to see output here</div>
  </div>
</div>

<script>
// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const v = id => document.getElementById(id)?.value?.trim() || '';

function ts() {
  return new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
}

function log(tag, content, tagClass = 'tag-info') {
  const body = document.getElementById('log-body');
  const first = body.firstElementChild;
  if (first?.style?.textAlign === 'center') first.remove();

  const el = document.createElement('div');
  el.className = 'log-entry';
  const isJson = typeof content === 'object';
  el.innerHTML = `
    <span class="log-ts">${ts()}</span>
    <span class="log-tag ${tagClass}">${tag}</span>
    <div class="log-content ${isJson ? 'log-json' : ''}">${isJson ? JSON.stringify(content, null, 2) : escHtml(String(content))}</div>
  `;
  body.appendChild(el);
  body.scrollTop = body.scrollHeight;

  // Flash blink
  const blink = document.getElementById('log-blink');
  blink.style.background = tagClass === 'tag-err' ? 'var(--red)' : 'var(--green)';
  setTimeout(() => { blink.style.background = 'var(--green)'; }, 600);
}

function escHtml(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function toast(msg, type = 'info') {
  const c = document.getElementById('toast-container');
  const t = document.createElement('div');
  t.className = `toast ${type}`;
  t.textContent = msg;
  c.appendChild(t);
  setTimeout(() => t.remove(), 3500);
}

// â”€â”€ API caller â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function callApi(method, url, body, btn, badgeId) {
  // Validate required-ish fields (non-empty check on url params)
  if (url.includes('undefined') || url.includes('null')) {
    toast('Please fill in all required fields', 'error');
    return;
  }

  btn.classList.add('loading');
  btn.disabled = true;

  const label = btn.querySelector('.btn-label')?.textContent || url;
  log(method, `${url}${body ? '\n' + JSON.stringify(body, null, 2) : ''}`, 'tag-info');

  try {
    const opts = {
      method,
      headers: { 'Content-Type': 'application/json' },
    };
    if (body && method !== 'GET' && method !== 'DELETE') {
      opts.body = JSON.stringify(body);
    }

    const res = await fetch(url, opts);
    const json = await res.json();

    if (json.error) {
      log('ERR', json.error, 'tag-err');
      if (json.logs?.length) json.logs.forEach(l => log('LOG', l, 'tag-err'));
      toast(`${label} failed`, 'error');
    } else {
      // Print logs first
      if (json.logs?.length) json.logs.forEach(l => log('LOG', l, 'tag-ok'));
      if (json.data) log('RES', json.data, 'tag-ok');
      if (badgeId) document.getElementById(badgeId)?.classList.add('done');
      toast(`${label} â€” OK`, 'success');
    }
  } catch (err) {
    log('ERR', err.message, 'tag-err');
    toast('Network error', 'error');
  } finally {
    btn.classList.remove('loading');
    btn.disabled = false;
  }
}


// â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll('.nav-item[data-section]').forEach(item => {
  item.addEventListener('click', e => {
    e.preventDefault();
    const target = item.dataset.section;
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    item.classList.add('active');
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(`section-${target}`)?.classList.add('active');
  });
});

// â”€â”€ SSE â€“ live notifications â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function connectSSE() {
  const es = new EventSource('/api/events');
  es.addEventListener('notification', e => {
    const data = JSON.parse(e.data);
    const feed = document.getElementById('notif-feed');
    const placeholder = feed.querySelector('[style*="Waiting"]');
    if (placeholder) placeholder.remove();

    const item = document.createElement('div');
    item.className = 'notif-item';
    item.innerHTML = `
      <div class="notif-type">${data.payload?.notificationType || 'webhook'}</div>
      <div class="notif-body">${JSON.stringify(data.payload, null, 2)}</div>
      <div class="notif-time">${data.timestamp}</div>
    `;
    feed.insertBefore(item, feed.firstChild);

    // Show nav dot
    document.getElementById('notif-nav-dot').classList.add('visible');
    toast('Webhook received: ' + (data.payload?.notificationType || 'event'), 'info');
    log('WEBHOOK', data.payload, 'tag-info');
  });

  es.onerror = () => {
    setTimeout(connectSSE, 3000); // reconnect
  };
})();
</script>
</body>
</html>
